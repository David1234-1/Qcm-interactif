<!DOCTYPE html>

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QCM Interactif avec IA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }
    
    .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    .header {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        padding: 30px;
        text-align: center;
    }
    
    .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
    }
    
    .header p {
        font-size: 1.1em;
        opacity: 0.9;
    }
    
    .content {
        padding: 30px;
    }
    
    .upload-zone {
        border: 3px dashed #667eea;
        border-radius: 15px;
        padding: 40px;
        text-align: center;
        margin-bottom: 30px;
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .upload-zone:hover {
        border-color: #764ba2;
        background: rgba(102, 126, 234, 0.05);
    }
    
    .upload-zone.dragover {
        border-color: #4CAF50;
        background: rgba(76, 175, 80, 0.1);
    }
    
    .upload-icon {
        font-size: 4em;
        margin-bottom: 20px;
        color: #667eea;
    }
    
    .upload-text {
        font-size: 1.2em;
        color: #333;
        margin-bottom: 10px;
    }
    
    .upload-subtext {
        color: #666;
        font-size: 0.9em;
    }
    
    .file-input {
        display: none;
    }
    
    .btn {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 30px;
        font-size: 1.1em;
        cursor: pointer;
        transition: transform 0.2s;
        margin: 10px;
    }
    
    .btn:hover {
        transform: translateY(-2px);
    }
    
    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    .processing {
        text-align: center;
        padding: 40px;
        display: none;
    }
    
    .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .quiz-container {
        display: none;
    }
    
    .question-card {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 30px;
        margin-bottom: 20px;
        border-left: 5px solid #667eea;
    }
    
    .question-title {
        font-size: 1.3em;
        font-weight: 600;
        color: #333;
        margin-bottom: 20px;
        line-height: 1.4;
    }
    
    .options {
        list-style: none;
    }
    
    .option {
        background: white;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 15px 20px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
    }
    
    .option:hover {
        border-color: #667eea;
        transform: translateX(5px);
    }
    
    .option.selected {
        border-color: #667eea;
        background: rgba(102, 126, 234, 0.1);
    }
    
    .option.correct {
        border-color: #28a745;
        background: rgba(40, 167, 69, 0.1);
    }
    
    .option.incorrect {
        border-color: #dc3545;
        background: rgba(220, 53, 69, 0.1);
    }
    
    .option-letter {
        background: #667eea;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-weight: 600;
    }
    
    .explanation {
        background: rgba(102, 126, 234, 0.1);
        border-radius: 10px;
        padding: 20px;
        margin-top: 15px;
        display: none;
        border-left: 4px solid #667eea;
    }
    
    .explanation h4 {
        color: #667eea;
        margin-bottom: 10px;
    }
    
    .progress {
        background: #e9ecef;
        border-radius: 20px;
        height: 8px;
        margin-bottom: 30px;
        overflow: hidden;
    }
    
    .progress-bar {
        background: linear-gradient(45deg, #667eea, #764ba2);
        height: 100%;
        width: 0%;
        transition: width 0.5s ease;
    }
    
    .score {
        text-align: center;
        font-size: 1.5em;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 20px;
    }
    
    .alert {
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    
    .alert-info {
        background: rgba(13, 202, 240, 0.1);
        border: 1px solid rgba(13, 202, 240, 0.2);
        color: #0c5460;
    }
    
    .alert-warning {
        background: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.2);
        color: #664d03;
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📚 QCM Interactif</h1>
            <p>Transformez vos PDF en quiz interactifs avec l'IA</p>
        </div>

```
    <div class="content">
        <div id="upload-section">
            <div class="alert alert-info">
                <strong>Instructions :</strong> Importez d'abord votre PDF de questions, puis votre PDF de corrections. L'IA analysera automatiquement le contenu pour créer votre quiz interactif.
            </div>
            
            <div class="upload-zone" id="upload-zone">
                <div class="upload-icon">📄</div>
                <div class="upload-text">Glissez vos fichiers PDF ici</div>
                <div class="upload-subtext">ou cliquez pour sélectionner</div>
                <input type="file" id="file-input" class="file-input" multiple accept=".pdf">
            </div>
            
            <div style="text-align: center;">
                <button class="btn" onclick="document.getElementById('file-input').click()">
                    Sélectionner les PDF
                </button>
                <button class="btn" id="process-btn" onclick="processFiles()" disabled>
                    Créer le Quiz
                </button>
            </div>
            
            <div id="file-list"></div>
        </div>
        
        <div class="processing" id="processing">
            <div class="spinner"></div>
            <h3>Analyse en cours...</h3>
            <p>L'IA traite vos PDF pour créer le quiz interactif</p>
        </div>
        
        <div class="quiz-container" id="quiz-container">
            <div class="progress">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
            <div class="score" id="score">Score: 0/0</div>
            <div id="questions-container"></div>
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="resetQuiz()">Recommencer</button>
                <button class="btn" onclick="showResults()">Voir les résultats</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Configuration PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    
    let uploadedFiles = [];
    let currentQuiz = null;
    let userAnswers = {};
    let score = 0;
    
    // Gestion du drag & drop
    const uploadZone = document.getElementById('upload-zone');
    const fileInput = document.getElementById('file-input');
    
    uploadZone.addEventListener('click', () => fileInput.click());
    
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragover');
    });
    
    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragover');
    });
    
    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
    });
    
    fileInput.addEventListener('change', (e) => {
        handleFiles(e.target.files);
    });
    
    function handleFiles(files) {
        uploadedFiles = Array.from(files).filter(file => file.type === 'application/pdf');
        displayFileList();
        
        if (uploadedFiles.length > 0) {
            document.getElementById('process-btn').disabled = false;
        }
    }
    
    function displayFileList() {
        const fileList = document.getElementById('file-list');
        if (uploadedFiles.length === 0) {
            fileList.innerHTML = '';
            return;
        }
        
        fileList.innerHTML = `
            <div style="margin-top: 20px;">
                <h4>Fichiers sélectionnés :</h4>
                ${uploadedFiles.map(file => `
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px; margin: 5px 0;">
                        📄 ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    async function processFiles() {
        document.getElementById('upload-section').style.display = 'none';
        document.getElementById('processing').style.display = 'block';
        
        try {
            // Extraction du texte des PDFs
            let allText = '';
            for (const file of uploadedFiles) {
                const text = await extractTextFromPDF(file);
                allText += text + '\n\n';
            }
            
            // Simulation d'analyse IA (remplacez par vraie IA)
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Génération du quiz (version simplifiée)
            const quiz = parseQCMFromText(allText);
            
            if (quiz.questions.length === 0) {
                throw new Error('Aucune question détectée dans vos PDF');
            }
            
            currentQuiz = quiz;
            displayQuiz(quiz);
            
        } catch (error) {
            alert('Erreur lors du traitement : ' + error.message);
            document.getElementById('upload-section').style.display = 'block';
            document.getElementById('processing').style.display = 'none';
        }
    }
    
    async function extractTextFromPDF(file) {
        return new Promise((resolve, reject) => {
            const fileReader = new FileReader();
            fileReader.onload = async function() {
                try {
                    const typedarray = new Uint8Array(this.result);
                    const pdf = await pdfjsLib.getDocument(typedarray).promise;
                    let text = '';
                    
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        text += pageText + ' ';
                    }
                    
                    resolve(text);
                } catch (error) {
                    reject(error);
                }
            };
            fileReader.readAsArrayBuffer(file);
        });
    }
    
    function parseQCMFromText(text) {
        // Parser basique - à améliorer avec une vraie IA
        const questions = [];
        
        // Regex pour détecter les questions (adaptez selon vos formats)
        const questionPattern = /(?:Question\s*\d+|Q\d+|\d+[\.\)])\s*(.+?)(?=Question\s*\d+|Q\d+|\d+[\.\)]|$)/gsi;
        const matches = text.match(questionPattern);
        
        if (matches) {
            matches.forEach((match, index) => {
                if (index < 5) { // Limite à 5 questions pour la demo
                    const optionPattern = /[A-D][\.\)]\s*(.+?)(?=[A-D][\.\)]|$)/gi;
                    const options = [];
                    let optionMatch;
                    
                    while ((optionMatch = optionPattern.exec(match)) !== null) {
                        options.push(optionMatch[1].trim());
                    }
                    
                    if (options.length >= 2) {
                        questions.push({
                            question: `Question ${index + 1}: ${match.split(/[A-D][\.\)]/)[0].trim()}`,
                            options: options.slice(0, 4),
                            correct: Math.floor(Math.random() * options.length), // Aléatoire pour la demo
                            explanation: "Explication générée par l'IA basée sur le contenu du PDF de correction."
                        });
                    }
                }
            });
        }
        
        // Questions de démonstration si aucune n'est détectée
        if (questions.length === 0) {
            questions.push(
                {
                    question: "Quelle est la capitale de la France ?",
                    options: ["Paris", "Lyon", "Marseille", "Lille"],
                    correct: 0,
                    explanation: "Paris est la capitale de la France depuis le 12ème siècle."
                },
                {
                    question: "Combien font 2 + 2 ?",
                    options: ["3", "4", "5", "6"],
                    correct: 1,
                    explanation: "2 + 2 = 4, c'est une addition de base."
                }
            );
        }
        
        return { questions };
    }
    
    function displayQuiz(quiz) {
        document.getElementById('processing').style.display = 'none';
        document.getElementById('quiz-container').style.display = 'block';
        
        const container = document.getElementById('questions-container');
        container.innerHTML = '';
        
        quiz.questions.forEach((q, qIndex) => {
            const questionDiv = document.createElement('div');
            questionDiv.className = 'question-card';
            questionDiv.innerHTML = `
                <div class="question-title">${q.question}</div>
                <ul class="options">
                    ${q.options.map((option, oIndex) => `
                        <li class="option" onclick="selectOption(${qIndex}, ${oIndex})">
                            <div class="option-letter">${String.fromCharCode(65 + oIndex)}</div>
                            <span>${option}</span>
                        </li>
                    `).join('')}
                </ul>
                <div class="explanation" id="explanation-${qIndex}">
                    <h4>💡 Explication</h4>
                    <p>${q.explanation}</p>
                </div>
            `;
            container.appendChild(questionDiv);
        });
        
        updateScore();
    }
    
    function selectOption(questionIndex, optionIndex) {
        const question = currentQuiz.questions[questionIndex];
        const options = document.querySelectorAll(`.question-card:nth-child(${questionIndex + 1}) .option`);
        
        // Reset styles
        options.forEach(opt => {
            opt.classList.remove('selected', 'correct', 'incorrect');
        });
        
        // Mark selected
        options[optionIndex].classList.add('selected');
        
        // Show correct answer
        options[question.correct].classList.add('correct');
        if (optionIndex !== question.correct) {
            options[optionIndex].classList.add('incorrect');
        }
        
        // Show explanation
        document.getElementById(`explanation-${questionIndex}`).style.display = 'block';
        
        // Update user answer
        userAnswers[questionIndex] = optionIndex;
        updateScore();
        updateProgress();
    }
    
    function updateScore() {
        score = 0;
        Object.keys(userAnswers).forEach(qIndex => {
            if (userAnswers[qIndex] === currentQuiz.questions[qIndex].correct) {
                score++;
            }
        });
        
        document.getElementById('score').textContent = 
            `Score: ${score}/${currentQuiz.questions.length} (${Math.round(score / currentQuiz.questions.length * 100)}%)`;
    }
    
    function updateProgress() {
        const answered = Object.keys(userAnswers).length;
        const total = currentQuiz.questions.length;
        const percentage = (answered / total) * 100;
        document.getElementById('progress-bar').style.width = percentage + '%';
    }
    
    function resetQuiz() {
        userAnswers = {};
        score = 0;
        
        // Reset all options
        document.querySelectorAll('.option').forEach(opt => {
            opt.classList.remove('selected', 'correct', 'incorrect');
        });
        
        // Hide explanations
        document.querySelectorAll('.explanation').forEach(exp => {
            exp.style.display = 'none';
        });
        
        updateScore();
        updateProgress();
    }
    
    function showResults() {
        const results = currentQuiz.questions.map((q, index) => {
            const userAnswer = userAnswers[index];
            const isCorrect = userAnswer === q.correct;
            return {
                question: q.question,
                userAnswer: userAnswer !== undefined ? q.options[userAnswer] : 'Non répondue',
                correctAnswer: q.options[q.correct],
                isCorrect
            };
        });
        
        const resultsWindow = window.open('', '_blank');
        resultsWindow.document.write(`
            <html>
            <head><title>Résultats du Quiz</title></head>
            <body style="font-family: Arial, sans-serif; padding: 20px;">
                <h1>📊 Résultats du Quiz</h1>
                <h2>Score final: ${score}/${currentQuiz.questions.length} (${Math.round(score / currentQuiz.questions.length * 100)}%)</h2>
                ${results.map((r, i) => `
                    <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px;">
                        <h3>Question ${i + 1}</h3>
                        <p><strong>Q:</strong> ${r.question}</p>
                        <p><strong>Votre réponse:</strong> <span style="color: ${r.isCorrect ? 'green' : 'red'}">${r.userAnswer}</span></p>
                        <p><strong>Bonne réponse:</strong> <span style="color: green">${r.correctAnswer}</span></p>
                        <p><strong>Résultat:</strong> ${r.isCorrect ? '✅ Correct' : '❌ Incorrect'}</p>
                    </div>
                `).join('')}
            </body>
            </html>
        `);
    }
</script>
```

</body>
</html>
